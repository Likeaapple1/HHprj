<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="salary">
		
		<select id="selectAllPayroll" parameterType="int" resultType="payrollDto">
			SELECT *
            FROM PAYROLL_PAYSLIP, EMP
            WHERE PAYROLL_PAYSLIP.EMP_NO = EMP.EMP_NO
		</select>
		
		<select id="selectAllPayrollByEmpNo" parameterType="long" resultType="payrollDto">
			SELECT
			PAYROLL_PAYSLIP.EMP_NO AS empNo,
			PAYROLL_NO,
			BASIC_SALARY,
			OVERTIME_ALLOWANCE,
			HOLIDAY_ALLOWANCE,
			ANNUAL_LEAVE_ALLOWANCE,
			MEAL_EXPENSES,
			TRANSPORTATION_EXPENSES,
			BONUS,
			SPECIAL_ALLOWANCE,
			EMPLOYMENT_INSURANCE,
			HEALTH_INSURANCE,
			NATIONAL_PENSION,
			TAX,
			LOCAL_INCOME_TAX,
			PAYROLL_BANK,
			PAYROLL_ACCOUNT,
			PAYROLL_DATE,
			
			(BASIC_SALARY +
			OVERTIME_ALLOWANCE +
			HOLIDAY_ALLOWANCE +
			ANNUAL_LEAVE_ALLOWANCE +
			MEAL_EXPENSES +
			TRANSPORTATION_EXPENSES +
			BONUS +
			SPECIAL_ALLOWANCE) AS totalSalary ,
			
			((BASIC_SALARY +
			OVERTIME_ALLOWANCE +
			HOLIDAY_ALLOWANCE +
			ANNUAL_LEAVE_ALLOWANCE +
			MEAL_EXPENSES +
			TRANSPORTATION_EXPENSES +
			BONUS +
			SPECIAL_ALLOWANCE) -
			(EMPLOYMENT_INSURANCE +
			HEALTH_INSURANCE +
			NATIONAL_PENSION +
			TAX +
			LOCAL_INCOME_TAX)) AS netSalary ,
			
			(EMPLOYMENT_INSURANCE +
			HEALTH_INSURANCE +
			NATIONAL_PENSION +
			TAX +
			LOCAL_INCOME_TAX) AS ehntl ,
			
			(EMPLOYMENT_INSURANCE +
			HEALTH_INSURANCE +
			NATIONAL_PENSION) AS fourMajorInsurances ,
			
			EMP_NAME,
			EMP_JOBCODE
			
			FROM PAYROLL_PAYSLIP, EMP
            WHERE PAYROLL_PAYSLIP.EMP_NO = EMP.EMP_NO
            AND PAYROLL_PAYSLIP.EMP_NO = #{empNo}
		</select>
		
		<select id="selectOneByPayroll" parameterType="string" resultType="payrollDto">
			SELECT
			PAYROLL_PAYSLIP.EMP_NO AS empNo,
			PAYROLL_NO,
			BASIC_SALARY,
			OVERTIME_ALLOWANCE,
			HOLIDAY_ALLOWANCE,
			ANNUAL_LEAVE_ALLOWANCE,
			MEAL_EXPENSES,
			TRANSPORTATION_EXPENSES,
			BONUS,
			SPECIAL_ALLOWANCE,
			EMPLOYMENT_INSURANCE,
			HEALTH_INSURANCE,
			NATIONAL_PENSION,
			TAX,
			LOCAL_INCOME_TAX,
			PAYROLL_BANK,
			PAYROLL_ACCOUNT,
			PAYROLL_DATE,
			
			(BASIC_SALARY +
			OVERTIME_ALLOWANCE +
			HOLIDAY_ALLOWANCE +
			ANNUAL_LEAVE_ALLOWANCE +
			MEAL_EXPENSES +
			TRANSPORTATION_EXPENSES +
			BONUS +
			SPECIAL_ALLOWANCE) AS totalSalary ,
			
			((BASIC_SALARY +
			OVERTIME_ALLOWANCE +
			HOLIDAY_ALLOWANCE +
			ANNUAL_LEAVE_ALLOWANCE +
			MEAL_EXPENSES +
			TRANSPORTATION_EXPENSES +
			BONUS +
			SPECIAL_ALLOWANCE) -
			(EMPLOYMENT_INSURANCE +
			HEALTH_INSURANCE +
			NATIONAL_PENSION +
			TAX +
			LOCAL_INCOME_TAX)) AS netSalary ,
			
			(EMPLOYMENT_INSURANCE +
			HEALTH_INSURANCE +
			NATIONAL_PENSION +
			TAX +
			LOCAL_INCOME_TAX) AS ehntl ,
			
			(EMPLOYMENT_INSURANCE +
			HEALTH_INSURANCE +
			NATIONAL_PENSION) AS fourMajorInsurances ,
			
			EMP_NAME,
			EMP_JOBCODE,
			DEPT_NAME
			
			FROM PAYROLL_PAYSLIP, EMP, DEPT
			WHERE PAYROLL_PAYSLIP.EMP_NO = EMP.EMP_NO AND EMP.EMP_NO = DEPT.EMP_NO
			AND PAYROLL_PAYSLIP.PAYROLL_NO = #{payrollNo}
		</select>
		
		
		
		
		
		<select id="selectOneBySalary" resultType="salaryDto">
				SELECT *
				FROM SALARY
	            WHERE EMP_NO = 1
		</select>
		

	
		
		<update id="setting" parameterType="salaryDto">
			UPDATE SALARY
			SET 
			  REGULAR_HOURLY_WAGE = #{regularHourlyWage}
			, LONG_SERVICE_DAY = #{longServiceDay}
			, LONG_SERVICE_ALLOWANCE = #{longServiceAllowance}
			, MEAL_EXPENSES = #{mealExpenses}
			, TRANSPORTATION_EXPENSES = #{transportationExpenses}
		</update>

		<!-- <delete id="delete" parameterType="payrollDto">
			DELETE FROM PAYROLL
			WHERE PAYROLL_DATE = #{payrollDate}
		</delete> -->
		
		
		
		<select id="selectOneByEmp" parameterType="string" resultType="payrollDto">
		SELECT
			EMP_NO,
			PAYROLL_NO,
			BASIC_SALARY,
			OVERTIME_ALLOWANCE,
			HOLIDAY_ALLOWANCE,
			ANNUAL_LEAVE_ALLOWANCE,
			MEAL_EXPENSES,
			TRANSPORTATION_EXPENSES,
			BONUS,
			SPECIAL_ALLOWANCE,
			EMPLOYMENT_INSURANCE,
			HEALTH_INSURANCE,
			NATIONAL_PENSION,
			TAX,
			LOCAL_INCOME_TAX,
			PAYROLL_BANK,
			PAYROLL_ACCOUNT,
			PAYROLL_DATE,
			
			(BASIC_SALARY +
			OVERTIME_ALLOWANCE +
			HOLIDAY_ALLOWANCE +
			ANNUAL_LEAVE_ALLOWANCE +
			MEAL_EXPENSES +
			TRANSPORTATION_EXPENSES +
			BONUS +
			SPECIAL_ALLOWANCE) AS totalSalary ,
			
			((BASIC_SALARY +
			OVERTIME_ALLOWANCE +
			HOLIDAY_ALLOWANCE +
			ANNUAL_LEAVE_ALLOWANCE +
			MEAL_EXPENSES +
			TRANSPORTATION_EXPENSES +
			BONUS +
			SPECIAL_ALLOWANCE) -
			(EMPLOYMENT_INSURANCE +
			HEALTH_INSURANCE +
			NATIONAL_PENSION +
			TAX +
			LOCAL_INCOME_TAX)) AS netSalary ,
			
			(EMPLOYMENT_INSURANCE +
			HEALTH_INSURANCE +
			NATIONAL_PENSION +
			TAX +
			LOCAL_INCOME_TAX) AS ehntl ,
			
			(EMPLOYMENT_INSURANCE +
			HEALTH_INSURANCE +
			NATIONAL_PENSION) AS fourMajorInsurances
			
			FROM PAYROLL_PAYSLIP
			WHERE EMP_NO = #{empNo}
		</select>

		<select id="selectEmail" parameterType="string" resultType="emailDto">
			SELECT 
			PAYROLL_PAYSLIP.EMP_NO AS PEN,
			PAYROLL_PAYSLIP.BASIC_SALARY AS PBS,
			
			(BASIC_SALARY +
			OVERTIME_ALLOWANCE +
			HOLIDAY_ALLOWANCE +
			ANNUAL_LEAVE_ALLOWANCE +
			MEAL_EXPENSES +
			TRANSPORTATION_EXPENSES +
			BONUS +
			SPECIAL_ALLOWANCE) AS PTS,
			
			((BASIC_SALARY +
			OVERTIME_ALLOWANCE +
			HOLIDAY_ALLOWANCE +
			ANNUAL_LEAVE_ALLOWANCE +
			MEAL_EXPENSES +
			TRANSPORTATION_EXPENSES +
			BONUS +
			SPECIAL_ALLOWANCE) -
			(EMPLOYMENT_INSURANCE +
			HEALTH_INSURANCE +
			NATIONAL_PENSION +
			TAX +
			LOCAL_INCOME_TAX)) AS PNS,
			
			(EMPLOYMENT_INSURANCE +
			HEALTH_INSURANCE +
			NATIONAL_PENSION +
			TAX +
			LOCAL_INCOME_TAX) AS ehntl,
			
			PAYROLL_PAYSLIP.PAYROLL_BANK AS PPB,
			PAYROLL_PAYSLIP.PAYROLL_ACCOUNT AS PPA,
			PAYROLL_PAYSLIP.PAYROLL_DATE AS PPD,
			EMP.EMP_NO AS EEN,
			EMP.EMP_NAME AS EENAME,
			EMP.EMP_EMAIL AS EEE,
			EMP.EMP_JOBCODE AS EEJ,
			DEPT.DEPT_NAME AS EMD
			FROM PAYROLL_PAYSLIP, EMP, DEPT
			WHERE PAYROLL_PAYSLIP.EMP_NO = EMP.EMP_NO AND DEPT.EMP_NO = EMP.EMP_NO
			ORDER BY PPD DESC
		</select>
		
		<select id="searchPayslip" resultType="payrollDto">
			SELECT
			EMP_NO,
			PAYROLL_NO,
			BASIC_SALARY,
			OVERTIME_ALLOWANCE,
			HOLIDAY_ALLOWANCE,
			ANNUAL_LEAVE_ALLOWANCE,
			MEAL_EXPENSES,
			TRANSPORTATION_EXPENSES,
			BONUS,
			SPECIAL_ALLOWANCE,
			EMPLOYMENT_INSURANCE,
			HEALTH_INSURANCE,
			NATIONAL_PENSION,
			TAX,
			LOCAL_INCOME_TAX,
			PAYROLL_BANK,
			PAYROLL_ACCOUNT,
			PAYROLL_DATE,
			
			(BASIC_SALARY +
			OVERTIME_ALLOWANCE +
			HOLIDAY_ALLOWANCE +
			ANNUAL_LEAVE_ALLOWANCE +
			MEAL_EXPENSES +
			TRANSPORTATION_EXPENSES +
			BONUS +
			SPECIAL_ALLOWANCE) AS totalSalary ,
			
			((BASIC_SALARY +
			OVERTIME_ALLOWANCE +
			HOLIDAY_ALLOWANCE +
			ANNUAL_LEAVE_ALLOWANCE +
			MEAL_EXPENSES +
			TRANSPORTATION_EXPENSES +
			BONUS +
			SPECIAL_ALLOWANCE) -
			(EMPLOYMENT_INSURANCE +
			HEALTH_INSURANCE +
			NATIONAL_PENSION +
			TAX +
			LOCAL_INCOME_TAX)) AS netSalary ,
			
			(EMPLOYMENT_INSURANCE +
			HEALTH_INSURANCE +
			NATIONAL_PENSION +
			TAX +
			LOCAL_INCOME_TAX) AS ehntl ,
			
			(EMPLOYMENT_INSURANCE +
			HEALTH_INSURANCE +
			NATIONAL_PENSION) AS fourMajorInsurances
			
			FROM PAYROLL_PAYSLIP
			WHERE EMP_NO = #{empNo}
			AND PAYROLL_DATE LIKE '#{month}-%'
		</select>
		
		
		
		
		








		<!-- 모든 사원 조회 -->
		<select id="selectAllEmpPayroll" resultType="inputDto">
			SELECT
				EMP.EMP_NO AS empNo,
				PAYROLL_NO,
				BASIC_SALARY,
				OVERTIME_ALLOWANCE,
				HOLIDAY_ALLOWANCE,
				ANNUAL_LEAVE_ALLOWANCE,
				PAYROLL.MEAL_EXPENSES AS MEAL_EXPENSES,
				PAYROLL.TRANSPORTATION_EXPENSES AS TRANSPORTATION_EXPENSES,
				BONUS,
				SPECIAL_ALLOWANCE,
				EMPLOYMENT_INSURANCE,
				HEALTH_INSURANCE,
				NATIONAL_PENSION,
				TAX,
				LOCAL_INCOME_TAX,
				PAYROLL.PAYROLL_BANK AS PAYROLL_BANK,
				PAYROLL.PAYROLL_ACCOUNT AS PAYROLL_ACCOUNT,
				PAYROLL_DATE,
				
				(BASIC_SALARY +
				OVERTIME_ALLOWANCE +
				HOLIDAY_ALLOWANCE +
				ANNUAL_LEAVE_ALLOWANCE +
				PAYROLL.MEAL_EXPENSES +
				PAYROLL.TRANSPORTATION_EXPENSES +
				BONUS +
				SPECIAL_ALLOWANCE) AS totalSalary ,
				
				((BASIC_SALARY +
				OVERTIME_ALLOWANCE +
				HOLIDAY_ALLOWANCE +
				ANNUAL_LEAVE_ALLOWANCE +
				PAYROLL.MEAL_EXPENSES +
				PAYROLL.TRANSPORTATION_EXPENSES +
				BONUS +
				SPECIAL_ALLOWANCE) -
				(EMPLOYMENT_INSURANCE +
				HEALTH_INSURANCE +
				NATIONAL_PENSION +
				TAX +
				LOCAL_INCOME_TAX)) AS netSalary ,
				
				(EMPLOYMENT_INSURANCE +
				HEALTH_INSURANCE +
				NATIONAL_PENSION +
				TAX +
				LOCAL_INCOME_TAX) AS ehntl ,
				
				(EMPLOYMENT_INSURANCE +
				HEALTH_INSURANCE +
				NATIONAL_PENSION) AS fourMajorInsurances ,
				
				EMP_NAME,
				EMP_JOBCODE,
				DEPT_NAME,
				
				SALARY.REGULAR_HOURLY_WAGE AS REGULAR_HOURLY_WAGE_S,
				SALARY.LONG_SERVICE_DAY AS LONG_SERVICE_DAY_S,
				SALARY.LONG_SERVICE_ALLOWANCE AS LONG_SERVICE_ALLOWANCE_S,
				SALARY.MEAL_EXPENSES AS MEAL_EXPENSES_S,
				SALARY.TRANSPORTATION_EXPENSES AS TRANSPORTATION_EXPENSES_S,
				SALARY.PAYROLL_BANK AS PAYROLL_BANK_S,
				SALARY.PAYROLL_ACCOUNT AS PAYROLL_ACCOUNT_S
				
			FROM EMP, DEPT, PAYROLL, SALARY
			WHERE EMP.EMP_NO = DEPT.EMP_NO AND EMP.EMP_NO = PAYROLL.EMP_NO AND EMP.EMP_NO = SALARY.EMP_NO
		</select>
		
		<!-- Input 사원 한명의 Payroll 조회 -->
		<select id="selectOneByEmpPayroll" resultType="inputDto">
			SELECT
				PAYROLL.EMP_NO AS empNo,
				PAYROLL_NO,
				BASIC_SALARY,
				OVERTIME_ALLOWANCE,
				HOLIDAY_ALLOWANCE,
				(SALARY.REGULAR_HOURLY_WAGE * 0<!-- 미사용연차 -->) AS ANNUAL_LEAVE_ALLOWANCE,
				(SALARY.MEAL_EXPENSES * 20<!-- 근무일수 -->) AS MEAL_EXPENSES,
				(SALARY.TRANSPORTATION_EXPENSES * 20<!-- 근무일수 -->) AS TRANSPORTATION_EXPENSES,
				BONUS,
				SPECIAL_ALLOWANCE,
				
				(BASIC_SALARY +
				OVERTIME_ALLOWANCE +
				HOLIDAY_ALLOWANCE +
				ANNUAL_LEAVE_ALLOWANCE +
				PAYROLL.MEAL_EXPENSES +
				PAYROLL.TRANSPORTATION_EXPENSES +
				BONUS +
				SPECIAL_ALLOWANCE) * 0.008 AS EMPLOYMENT_INSURANCE,
				(BASIC_SALARY +
				OVERTIME_ALLOWANCE +
				HOLIDAY_ALLOWANCE +
				ANNUAL_LEAVE_ALLOWANCE +
				PAYROLL.MEAL_EXPENSES +
				PAYROLL.TRANSPORTATION_EXPENSES +
				BONUS +
				SPECIAL_ALLOWANCE) * 0.03495 AS HEALTH_INSURANCE,
				(BASIC_SALARY +
				OVERTIME_ALLOWANCE +
				HOLIDAY_ALLOWANCE +
				ANNUAL_LEAVE_ALLOWANCE +
				PAYROLL.MEAL_EXPENSES +
				PAYROLL.TRANSPORTATION_EXPENSES +
				BONUS +
				SPECIAL_ALLOWANCE) * 0.045 AS NATIONAL_PENSION,
				
				(BASIC_SALARY +
				OVERTIME_ALLOWANCE +
				HOLIDAY_ALLOWANCE +
				ANNUAL_LEAVE_ALLOWANCE +
				PAYROLL.MEAL_EXPENSES +
				PAYROLL.TRANSPORTATION_EXPENSES +
				BONUS +
				SPECIAL_ALLOWANCE) * 0.01 AS TAX,
				((BASIC_SALARY +
				OVERTIME_ALLOWANCE +
				HOLIDAY_ALLOWANCE +
				ANNUAL_LEAVE_ALLOWANCE +
				PAYROLL.MEAL_EXPENSES +
				PAYROLL.TRANSPORTATION_EXPENSES +
				BONUS +
				SPECIAL_ALLOWANCE) * 0.01) * 0.1 AS LOCAL_INCOME_TAX,
				
				PAYROLL.PAYROLL_BANK AS PAYROLL_BANK,
				PAYROLL.PAYROLL_ACCOUNT AS PAYROLL_ACCOUNT,
				PAYROLL_DATE,
				
				(BASIC_SALARY +
				OVERTIME_ALLOWANCE +
				HOLIDAY_ALLOWANCE +
				ANNUAL_LEAVE_ALLOWANCE +
				PAYROLL.MEAL_EXPENSES +
				PAYROLL.TRANSPORTATION_EXPENSES +
				BONUS +
				SPECIAL_ALLOWANCE) AS totalSalary ,
				
				((BASIC_SALARY +
				OVERTIME_ALLOWANCE +
				HOLIDAY_ALLOWANCE +
				ANNUAL_LEAVE_ALLOWANCE +
				PAYROLL.MEAL_EXPENSES +
				PAYROLL.TRANSPORTATION_EXPENSES +
				BONUS +
				SPECIAL_ALLOWANCE) -
				(EMPLOYMENT_INSURANCE +
				HEALTH_INSURANCE +
				NATIONAL_PENSION +
				TAX +
				LOCAL_INCOME_TAX)) AS netSalary ,
				
				(EMPLOYMENT_INSURANCE +
				HEALTH_INSURANCE +
				NATIONAL_PENSION +
				TAX +
				LOCAL_INCOME_TAX) AS ehntl ,
				
				(EMPLOYMENT_INSURANCE +
				HEALTH_INSURANCE +
				NATIONAL_PENSION) AS fourMajorInsurances ,
				
				EMP_NAME,
				EMP_JOBCODE,
				DEPT_NAME,
				
				SALARY.REGULAR_HOURLY_WAGE AS REGULAR_HOURLY_WAGE_S,
				(SALARY.REGULAR_HOURLY_WAGE * 8 * 20<!-- 근무시간 -->) * 1.2 AS BASIC_SALARY_S,
				(SALARY.REGULAR_HOURLY_WAGE * 0<!-- 추가근무시간 -->) * 1.5 AS OVERTIME_ALLOWANCE_S,
				(SALARY.REGULAR_HOURLY_WAGE * 0<!-- 휴일근무시간 -->) * 1.5 AS HOLIDAY_ALLOWANCE_S,
				SALARY.LONG_SERVICE_DAY AS LONG_SERVICE_DAY_S,
				SALARY.LONG_SERVICE_ALLOWANCE AS LONG_SERVICE_ALLOWANCE_S,
				SALARY.MEAL_EXPENSES AS MEAL_EXPENSES_S,
				SALARY.TRANSPORTATION_EXPENSES AS TRANSPORTATION_EXPENSES_S,
				SALARY.PAYROLL_BANK AS PAYROLL_BANK_S,
				SALARY.PAYROLL_ACCOUNT AS PAYROLL_ACCOUNT_S
				
			FROM EMP, DEPT, PAYROLL, SALARY
			WHERE EMP.EMP_NO = DEPT.EMP_NO AND EMP.EMP_NO = PAYROLL.EMP_NO AND EMP.EMP_NO = SALARY.EMP_NO
			AND PAYROLL.PAYROLL_NO = #{payrollNo}
		</select>
		
		<!-- Payroll 추가 -->
		<insert id="insertPayroll">
			INSERT INTO PAYROLL_PAYSLIP (
				EMP_NO,
				PAYROLL_NO,
				BASIC_SALARY,
				OVERTIME_ALLOWANCE,
				HOLIDAY_ALLOWANCE,
				ANNUAL_LEAVE_ALLOWANCE,
				MEAL_EXPENSES,
				TRANSPORTATION_EXPENSES,
				BONUS,
				SPECIAL_ALLOWANCE,
				EMPLOYMENT_INSURANCE,
				HEALTH_INSURANCE,
				NATIONAL_PENSION,
				TAX,
				LOCAL_INCOME_TAX,
				PAYROLL_BANK,
				PAYROLL_ACCOUNT,
				PAYROLL_DATE
			)
			VALUES
			(
				  #{empNo}
				, PAYROLL_NO_SEQ.NEXTVAL
				, #{basicSalary}
				, #{overtimeAllowance}
				, #{holidayAllowance}
				, #{annualLeaveAllowance}
				, #{mealExpenses}
				, #{transportationExpenses}
				, #{bonus}
				, #{specialAllowance}
				, #{employmentInsurance}
				, #{healthInsurance}
				, #{nationalPension}
				, #{tax}
				, #{localIncomeTax}
				, #{payrollBank}
				, #{payrollAccount}
				, SYSDATE
			)
		</insert>
	
		
		

</mapper>